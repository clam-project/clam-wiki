== Install XCode Tools ==
* (From the macports doc) Do not install an older version from the OS X 10.4 install disk or some ports may fail to install. You can download it from here http://connect.apple.com/
* Run the binary installer.
* Click Customize, expand the Applications category and click the checkbox beside X11 SDK to add it to the default items.
* Click Install to install Xcode Tools and the X11 SDK.

== Install Macports packages ==

* First, download and install macports binaries that allow search and install other software (similar to apt-get) 
  http://darwinports.opendarwin.org/
  A direct link for a Tiger universal binary:
  $ wget http://darwinports.opendarwin.org/downloads/DarwinPorts-1.3.1-10.4.dmg

* Check that ~/.profile has been automatically modified with PATH pointing at /opt/local/bin

* You maybe will need to start a new terminal to refresh the PATH value. 

* If you don't have wget installed it, consider doing it now, it always comes handy:
  $ sudo port install wget

* Install CLAM dependencies available in darwinports. This command will compile each packages from upstream (the original project site) and will automatically pull its dependencies:
   $ sudo port install xercesc pkgconfig libsndfile libogg libmad libvorbis fftw-single fftw cppunit qt3-mac id3lib

* python and scons are also in macports. They are needed as build tools. CLAM builds both with scons/python in darwinports and with the native packages.
  $ sudo port install scons

== Install packages not available in darwinports ==

* portaudio
   $ wget http://www.portaudio.com/archives/pa_snapshot_v19.tar.gz
:  untar the package, 
   $ ./configure --disable-portaudio
   $ make 
:  and finally 
   $ sudo make install

* qt4.2 mac-free (not x11)
   $ wget http://ftp.iasi.roedu.net/mirrors/ftp.trolltech.com/qt/source/qt-mac-opensource-src-4.2.2.tar.gz
: and do the typical dance (macport devs devels informed us that a macport for qt4 is on the way)

== CLAM build ==

* if you want to get CLAM sources using subversion you should install it too
   $ sudo port install subversion
   $ svn co http://iua-share.upf.edu/svn/clam/trunk

:Read the CLAM/INSTALL file if you're not familiar with the clam scons   build sequence:
  $ scons configure with_ladspa_support=0
  $ scons
  $ sudo scons install

* One of the clam libs (libclam_vmqt) depends on qt3, so in order to use the macport version of qt3, make sure that QTDIR is undefined when configuring and compiling clam libs. (export QTDIR= )
* On the other hand, you'll need to export QTDIR to qt4 when compiling networkeditor and annotator. So:
** before doing clam "scons configure" and "scons" make sure that QTDIR is not set.
** before compiling SMSTools make sure that QTDIR is not set
** before compiling Annotator (and its inner /vmqt lib) make QTDIR point to qt4 (in my case export QTDIR=/usr/local/Trolltech/Qt-4.2.2/)
** before compiling NetworkEditor make QTDIR point to qt4

 
* Remember that before building Annotator you must build Annotator/vmqt

* All applications should build and run. Inform clam-devel for any problem  
 
* applications packaging :
** just do 'scons bundle' and 'scons package'

* Tip: use non system clam prefix (!= usr/local) for developing


== Troubleshooting ==

* I (Pau) got this weird error when executing clam-unrelated applications like gvim : "dyld: Symbol not found: __cg_jpeg_resync_to_restart" it is a  bug explained here: http://bugs.wireshark.org/bugzilla/show_bug.cgi?id=1131 In my case I had to remove /opt/local/lib from  DYLD_LIBRARY_PATH. You can also add export DYLD_FALLBACK_LIBRARY_PATH=/opt/local/lib but it's not    really necessary for CLAM

* If you have problems with "scons configure" it might be that you are not using macports pkg-config. Check this
   $ which pkg-config
   /opt/local/bin/pkg-config
   $ which uic
   /opt/local/bin/uic
   If you have non macport versions, change the PATH variable so that it starts with /opt/local/bin

* If you have problems related with qt3 configure or compilation check this
   $ pkg-config qt-mt --libs -framework Carbon -framework QuickTime -framework OpenGL -framework AGL -L/opt/local/lib -lqt-mt -lz  
:If you see X11 libs you probably have a wrong (x11) qt3 version and  should install "qt3-mac" (macport name)

* If some library fails to configure inform the clam-devel list but you can try with a subset. For example I first compiled clam with this clam.conf :

 prefix = '/Users/parumi/clamSandboxes/local'
 release = 1
 double = 0
 sandbox = 1
 checks = 1
 release_asserts = 0
 with_ladspa_support = 1
 with_osc_support = 0
 with_jack_support = 1
 with_fftw = 1
 with_nr_fft = 1
 with_sndfile = 1
 with_oggvorbis = 1
 with_mad = 1
 with_id3 = 1
 with_portaudio = 1
 with_portmidi = 0
